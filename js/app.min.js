var page=0,startTime=(new Date).toUTCString(),id=Math.floor(1e14*Math.random()),db=null,dbEntryPath="survey-data-"+env+"/entries/entry_",dbOverviewPath="survey-data-"+env+"/overview/";function initDB(){db=firebase.database()}function initQuiz(){var t=$("#page"+page),e=$(".highlight-container.media-large .item");displayStatistics(),$(".page.load").removeClass("load"),t.addClass("show");for(var a=0;a<e.length;a++){var n=Math.floor(Math.random()*e.length-1)+1,r=Math.floor(Math.random()*e.length-1)+1;e.eq(n).before(e.eq(r))}randomizePage(),randomizeContent(++page),$('.page[value="landing-page"]').remove()}function updateEntries(t){db.ref(dbEntryPath+id).update(t)}function changePage(t){var e=$("#page"+t);$(".page.show").removeClass("show"),e.addClass("show")}function nextPage(t){var e=$("#page"+page);1==page&&db.ref(dbOverviewPath+"total/participants/started").transaction(function(t){return null==t?1:t+1}),$("#page"+page+" .question-title").each(function(){$(this).text("Question "+(page-1))}),collectAndSendInputs(page,t),changePage(page),randomizeContent(++page),0!==$(e).find(".page-results").length&&displayResult()}function loadResultData(t){var e;db.ref(dbEntryPath+id+"/results/").once("value").then(function(a){e=a.val(),t(e)})}function loadOverviewData(t){var e;db.ref(dbOverviewPath).once("value").then(function(a){e=a.val(),t(e)})}function displayStatistics(){var t;loadOverviewData(function(e){var a=(t=e).total.participants.completed,n=(t.total.answersCompleted.answers,((t.total.answersCompleted.correct||0)/a).toFixed(0)),r=t.perContentType.image.answers,i=((t.perContentType.image.correct||0)/r*100).toFixed(0),o=t.perContentType.text.answers,s=((t.perContentType.text.correct||0)/o*100).toFixed(0);$('span[data="participants"').text(a),$('span[data="avgResult"').text(n),$('span[data="imagePercentage"').text(i),$('span[data="textPercentage"').text(s),$('span[count="true"]').each(function(){$(this).prop("Counter",0).animate({Counter:$(this).text()},{duration:4e3,easing:"swing",step:function(t){$(this).text(Math.ceil(t))}})})})}function displayResult(){var t,e;db.ref(dbOverviewPath+"total/participants/completed").transaction(function(t){return null==t?1:t+1}),loadResultData(function(a){var n=(t=a).total.answered,r=t.total.correct||0,i=t.total.wrong||0;db.ref(dbOverviewPath+"total/answersCompleted/answers").transaction(function(t){return null==t?n:t+n}),db.ref(dbOverviewPath+"total/answersCompleted/correct").transaction(function(t){return null==t?r:t+r}),db.ref(dbOverviewPath+"total/answersCompleted/wrong").transaction(function(t){return null==t?i:t+i}),loadOverviewData(function(a){var i=0,o=((e=a).total.answers.answers,e.total.answers.correct,e.total.participants.completed),s=(e.total.answersCompleted.answers,((e.total.answersCompleted.correct||0)/o).toFixed(0)),d=e.perContentType.image.answers,l=((e.perContentType.image.correct||0)/d*100).toFixed(0),c=e.perContentType.text.answers,u=((e.perContentType.text.correct||0)/c*100).toFixed(0),p=$("template#resultItem").html();$('span[data="correct"').text(r),$('span[data="answered"').text("/"+n),$('span[data="participants"').text(o),$('span[data="avgResult"').text(s+"/"+n),$('span[data="imagePercentage"').text(l),$('span[data="textPercentage"').text(u),$.map(t,function(t){if(i++,"id"in t){t.id;var a,n=t.contentId,r=t.contentType,o=t.result,s=t.validity,d=$("#"+n),l=d.attr("src"),c=$(d).find(".text-title > span").text(),u=$(d).find(".text-content > p").text(),v=e.perContent[r+"_"+n].answers,f=((e.perContent[r+"_"+n].correct||0)/v*100).toFixed(0),g=$(p);g.addClass(r),"text"==r?(g.find('div[data="contentTypeImage"]').css("display","none"),g.find('div[data="contentTypeText"] > .text-title > span').text(c),g.find('div[data="contentTypeText"] > .text-content > p').text(u),a="Written by "+s):"image"==r&&(g.find('div[data="contentTypeText"]').css("display","none"),g.find('img[data="contentImage"]').attr("src",l),"Humans"==s?a="A real Human":"AI"==s&&(a="Generated by "+s)),"Humans"==s?(g.find('div[data="validity"] img[value="ai"]').css("display","none"),g.find('div[data="validity"] > span').text(a),"correct"==o?g.find('div[data="guess"] > span').text("You guessed Human"):"wrong"==o&&g.find('div[data="guess"] > span').text("You guessed AI")):"AI"==s&&(g.find('div[data="validity"] img[value="human"]').css("display","none"),g.find('div[data="validity"] > span').text(a),"correct"==o?g.find('div[data="guess"] > span').text("You guessed AI"):"wrong"==o&&g.find('div[data="guess"] > span').text("You guessed Human")),g.find('div[data="result"]').addClass(o);for(var h=0;h<src[n].href.length;h++){var m=g.find('div[data="source"]');h>0&&$("<span/>",{text:" + "}).appendTo(m),$("<a/>",{target:"_blank",href:src[n].href[h],text:src[n].text[h]}).appendTo(m)}g.find('div[data="percentage"] > span').text(f+"% of people guessed correctly from a total of "+v+" answers"),"correct"==o?g.find('div[data="result"] > svg[value="wrong"]').css("display","none"):"wrong"==o&&g.find('div[data="result"] > svg[value="correct"]').css("display","none"),g.find('span[data="questionNumber"]').text("Question "+i),$(".result.breakdown").append(g)}})})})}function randomizeContent(t){for(var e,a=$("#page"+t+" .random"),n=0;n<a.length;n++){var r=Math.floor(Math.random()*a.length-1)+1,i=Math.floor(Math.random()*a.length-1)+1;a.eq(r).before(a.eq(i))}(e=$("#page"+t+" .randomize > *:nth-child(2)")).addClass("chosen"),e.attr("src",e.attr("data-src"));for(n=0;n<a.length;n++)$(a[n]).hasClass("chosen")||a[n].remove()}function randomizePage(){for(var t=$('.page[value="question"]'),e=2,a=0;a<t.length;a++){var n=Math.floor(Math.random()*t.length-1)+1,r=Math.floor(Math.random()*t.length-1)+1;t.eq(n).before(t.eq(r))}(t=$('.page[value="question"]')).each(function(){$(this).attr("id","page"+e),e++})}function collectAndSendInputs(t,e){var a=$(e),n="results/question_",r={},i=t-1,o=i-2;$("#page"+i+" .question").each(function(){var t,e=$(this),i=$(".chosen[question="+e.attr("id")+"]"),s=e.attr("id"),d=i.attr("id"),l=e.attr("type"),c="no answer";t=d%2==0?"AI":"Humans",$("input",e).each(function(){var t=$(this);r[n+o+"_"+s+"/"+t.attr("value")]="false",(t=a)&&(r[n+o+"_"+s+"/"+t.attr("value")]="true",c="selectsAI"==a.attr("value")&&d%2==0?"correct":"selectsHuman"==a.attr("value")&&1==Math.abs(d%2)?"correct":"wrong")});var u="perQuestion/question_"+s,p="perContent/"+l+"_"+d,v="perContentType/"+l;db.ref(dbOverviewPath+"total//answers/answers").transaction(function(t){return null==t?1:t+1}),db.ref(dbOverviewPath+"total//answers/"+c).transaction(function(t){return null==t?1:t+1}),db.ref(dbOverviewPath+u+"/answers").transaction(function(t){return null==t?1:t+1}),db.ref(dbOverviewPath+u+"/"+c).transaction(function(t){return null==t?1:t+1}),db.ref(dbOverviewPath+v+"/answers").transaction(function(t){return null==t?1:t+1}),db.ref(dbOverviewPath+v+"/"+c).transaction(function(t){return null==t?1:t+1}),db.ref(dbOverviewPath+p+"/answers").transaction(function(t){return null==t?1:t+1}),db.ref(dbOverviewPath+p+"/"+c).transaction(function(t){return null==t?1:t+1}),r.id=id,r.startTime=startTime,r.completeTime=(new Date).toUTCString(),r[n+o+"_"+s+"/id"]=s,r[n+o+"_"+s+"/contentId"]=d,r[n+o+"_"+s+"/contentType"]=l,r[n+o+"_"+s+"/validity"]=t,r[n+o+"_"+s+"/result"]=c,updateEntries(r),db.ref(dbEntryPath+id+"/results/total/answered").transaction(function(t){return null==t?1:t+1}),db.ref(dbEntryPath+id+"/results/total/"+c).transaction(function(t){return null==t?1:t+1})})}function animateFavicon(){var t=["assets/favicon-1.ico","assets/favicon-2.ico"],e=0;setInterval(function(){$("link[rel='icon']").remove(),$("link[rel='shortcut icon']").remove(),$("head").append('<link rel="icon" href="'+baseurl+t[e]+'" type="image/x-icon">'),e==t.length-1?e=0:e++},500)}function start(){initDB(),initQuiz(),animateFavicon()}